<script>
  $(".group.base-extend>.in>.ct>.in").append(
    '<div class="list-text share e-book"><div class="in"><div class="hd"><div class="in"><div> <span><a href="#" class="e-book-open" title="E-GOV小幫手">E-GOV小幫手</a></span></div></div></div></div></div>'
  );
</script>
<style type="text/css">
  .base-extend .list-text.share.e-book .hd a {
    position: absolute;
    top: 0;
    right: 0;
    bottom: 0;
    left: 0;
    transition: 150ms;
    border-radius: 100%;
    background-image: url(../images/icon-pic/main-ebook.png?1583227606);
    background-repeat: no-repeat;
    background-position: center;
    border-radius: 100%;
    border: 2px solid #343434;
  }

  .base-extend .list-text.link {
    right: 136px !important;
  }

  .list-text.font-size {
    right: 96px !important;
  }

  .base-extend .list-text.share {
    right: 48px !important;
  }

  .base-extend .list-text.share.e-book {
    right: 0px !important;
  }
</style>
<script src="https://www.gov.tw/Scripts/jquery-ui.min.js?1"></script>
<div
  class="area-editor default e-book"
  data-addparentgroup="False"
  data-anchor=""
  data-bgclass="e-book"
  data-bgcolor="#0000ffff"
  data-child="1"
  data-groupname=""
  data-groupsn="2273"
  data-index="4"
  data-isgroup="true"
  data-margin_bottom="0"
  data-margin_defaultsetting="false"
  data-margin_left="0"
  data-margin_right="0"
  data-margin_top="0"
  data-menuwidth=""
  data-setlen="0"
  data-sitesmodulesn="6"
  data-sort="8"
  data-tabtype="0"
  data-type="0"
  data-widthdesktop="0"
  data-widthmobile="0"
  data-widthpad="0"
  id="Group_2273_YYpUwxTtPL"
>
  <div class="in">
    <div class="ct">
      <div class="in">&nbsp;</div>
    </div>
  </div>
</div>
<link
  href="https://www.gov.tw/css/chatbottext.css"
  rel="stylesheet"
  type="text/css"
/>
<style type="text/css">
  .autocomplete-items {
    /*position: absolute;*/
    border: 1px solid #d4d4d4;
    border-bottom: none;
    border-top: none;
    z-index: 99;
    /*position the autocomplete items to be the same width as the container:*/
    top: 100%;
    left: 0;
    right: 0;
  }

  .autocomplete-items div {
    padding: 10px;
    cursor: pointer;
    background-color: #fff;
    border-bottom: 1px solid #d4d4d4;
  }

  /*when hovering an item:*/
  .autocomplete-items div:hover {
    background-color: #e9e9e9;
  }

  a.e-book-close {
    position: relative;
    right: -112px;
    top: -11px;
  }
  /*when navigating through the items using the arrow keys:*/
  .autocomplete-active {
    background-color: DodgerBlue !important;
    color: #ffffff;
  }
</style>
<script>
  $(document).ready(function () {
    $("#talkhot, #talkhotclose").click(function () {
      $(".hot_list").slideToggle("fast");
      if ($(this).hasClass("is-active")) {
        $(this).removeClass("is-active");
      } else {
        $(this).addClass("is-active");
      }
    });
    try {
      $(".CustomerService").draggable({
        containment: "window",
        drag: function (event, ui) {
          var pos = ui.position;
          $(".e-book-close").css({
            left: pos.left + 112,
            top: pos.top - 11,
          });
        },
      });
    } catch (e) {}
    $(".CustomerService").click(function () {
      $(this).hide();
      $(".e-book-close").hide();
      $(".talk_con").show();
    });

    $(".close").click(function () {
      $(".CustomerService").show();
      $(".e-book-close").show();
      $(".talk_con").hide();
    });
    $("a.btn").click(function () {
      $(this).parent().find(".box").slideToggle("fast");
      $(".informationBlock>div").hide();
    });
    $(".btn_statify").click(function () {
      $(".information>.box").slideToggle("fast");
      $(".informationBlock>div").hide();
      $(".informationBlock>.statify").show();
    });
    //$(".btn_privacy").click(function () {
    //    $('.information').find(".box").slideToggle("fast");
    //    $('.informationBlock>div').hide();
    //    $('.informationBlock>.privacy').show();
    //});
    $(".e-book-close").click(function (e) {
      e.preventDefault();
      $(".e-book-icon").hide();
    });
    $(".e-book-open").click(function (e) {
      e.preventDefault();
      $(".e-book-icon").show();
    });
    $("#gotoComputerBtn_mobile").click(function (e) {
      e.preventDefault();
      $(".e-book-icon").show();
      $(".base-mobile>.in>.hd>.in").find("a").trigger("click");
    });

    $(".btn_description").click(function () {
      $(".information").find(".box").slideToggle("fast");
      $(".informationBlock>div").hide();
      $(".informationBlock>.description").show();
    });
    //font_size
    $(".font")
      .find("li")
      .click(function () {
        $(".font").find("li").removeClass("is-active");
        var li = $(this);
        if ($(this).hasClass("small")) {
          $(".talk_show").css("font-size", "0.5rem");
          setCookie("fontsize", "small", 365);
        } else if ($(this).hasClass("medium")) {
          $(".talk_show").css("font-size", "1rem");
          setCookie("fontsize", "medium", 365);
        } else if ($(this).hasClass("large")) {
          $(".talk_show").css("font-size", "1.5rem");
          setCookie("fontsize", "large", 365);
        }
        li.addClass("is-active");
      });

    //?
    $(document)
      .ajaxStart(function () {
        $("#tempwords").show();
        $("#tempwords").append(
          '<div class="atalk"><span class="dialog temploading" style="height: 25px;width: 70px;"><div class="typing-loader"></div></span></div>'
        );
        var objDiv = document.getElementById("words");
        objDiv.scrollTop = objDiv.scrollHeight;
      })
      .ajaxStop(function () {
        $(".temploading").parent().remove();
        $("#tempwords").hide();
      });

    //autocomplete

    var autocompleteurl =
      "https://www.gov.tw/chatbotapi.aspx?type=autocomplete";
    $.ajax({
      type: "get",
      url: autocompleteurl,
      cache: true,
      success: function (obj) {
        autocomplete(document.getElementById("talkwords"), obj);
      },
    });
  });

  inactivityTime();
  function inactivityTime() {
    var t;
    var t2;
    resetTimer();
    $(".talk_con")
      .find("a,input")
      .click(function () {
        console.log($(this));
        resetTimer();
      });
    function logout() {
      var Rolevalues = new Array();
      $.each($(".user li input:checked"), function () {
        Rolevalues.push($(this).val());
      });
      $.ajax({
        type: "get",
        url:
          "https://www.gov.tw/chatbotapi.aspx?type=idlerecommend&role=" +
          Rolevalues.toString(),
        cache: true,
        success: function (obj) {
          append(obj);
        },
      });
      setTimeout(function () {
        getLifeEvent("本站針對熱門服務做了一些分類");
      }, 1000);
    }
    function closewindow() {
      $(".CustomerService").show();
      $(".talk_con").hide();
    }

    function resetTimer() {
      console.log("reset");
      clearTimeout(t);
      clearTimeout(t2);
      var sessionTimeoutWarning = 2; //min
      var sTimeout = parseInt(sessionTimeoutWarning) * 60 * 1000;
      t = setTimeout(logout, sTimeout);
      var sessionTimeoutWarning2 = 10; //min
      var sTimeout2 = parseInt(sessionTimeoutWarning2) * 60 * 1000;
      t2 = setTimeout(closewindow, sTimeout2);
    }
  }
</script>
<script type="text/javascript">
  var temp = "";
  window.onload = function () {
    var Words = document.getElementById("words");
    var Who = document.getElementById("who");
    var TalkWords = document.getElementById("talkwords");
    var TalkSub = document.getElementById("talksub");
    var notfundcount = 0;

    $("#talkwords").keydown(function (event) {
      if (event.which == 13) {
        $("#talksub").trigger("click");
      }
    });
    TalkSub.onclick = function () {
      //定義空字串
      var str = "";
      if (TalkWords.value == "") {
        // 訊息為空時彈窗
        alert("訊息不能為空");
        return;
      }
      str =
        '<div class="btalk"><span class="dialog">' +
        TalkWords.value +
        getDateString() +
        "</span></div>";
      append(str);
      //str += '<div class="atalk"><span><iframe src=\"News3_Cus.aspx?n=2&sms=9037&sk=0,&sq=' + TalkWords.value + '\"></span></div>';
      var returntext;
      var searchword = TalkWords.value;
      TalkWords.value = "";

      $.ajax({
        type: "get",
        url:
          "https://www.gov.tw/chatbotlogapi.aspx?type=searchlog&n=2&chatbot=1&sms=9037&s=" +
          searchword +
          "&sk=0&page=1&PageSize=5&city=" +
          city,
        cache: true,
        success: function (obj) {},
      });

      $.ajax({
        type: "get",
        url: "https://www.gov.tw/chatbotapi.aspx?type=check&s=" + searchword,
        cache: true,
        success: function (obj) {
          returntext = obj;
          temp = obj;
          if (returntext != null && returntext != "" && returntext != "\r\n") {
            str =
              '<div class="atalk"><span class="dialog">' +
              returntext +
              "" +
              getDateString() +
              "</span></div>";
            append(str);
            //getLifeEvent("試著找找別的服務吧!");
          } else {
            var lifeeventobj;
            var topicobj;
            $.ajax({
              type: "get",
              url:
                "https://www.gov.tw/chatbotapi.aspx?type=Search&s=" +
                searchword,
              cache: true,
              success: function (obj) {
                lifeeventobj = obj;
                var IsSatisfy = false;
                $.ajax({
                  type: "get",
                  url:
                    "https://www.gov.tw/chatbotapi.aspx?type=searchtopic&s=" +
                    searchword,
                  cache: true,
                  dataType: "html",
                  success: function (obj2) {
                    try {
                      topicobj = obj2;
                      if (lifeeventobj.length > 0) {
                        var str =
                          '<div class="atalk"><span class="dialog">也許下列會有您需要的服務?<br/><ul>';
                        lifeeventobj.forEach(
                          (element) =>
                            (str +=
                              '<li><a class="lifeeventsec" href="' +
                              element.url +
                              '" target="_blank" data-SN="' +
                              element.SN +
                              '" data-Name="' +
                              element.Name +
                              '">' +
                              element.Name +
                              "<span>" +
                              element.dep +
                              "</span></a></li>")
                        );
                        str +=
                          '</ul><a target="_blank" href="Advanced_Search.aspx?q=' +
                          searchword +
                          '" title="更多服務" class="talk_sub btnmore" >更多服務</a>' +
                          getDateString() +
                          "</span></div>";
                        append(str);

                        IsSatisfy = true;
                        $(".lifeeventsec").click(function () {
                          console.log($(this).attr("href"));
                          savelog("linkto:" + $(this).attr("href"));
                        });
                        notfundcount = 0;
                      } else {
                        $.ajax({
                          type: "get",
                          url:
                            "https://www.gov.tw/chatbotapi.aspx?type=Search&s=" +
                            searchword,
                          cache: true,
                          async: false,
                          success: function (obj) {
                            lifeeventobj = obj;
                          },
                        });

                        if (lifeeventobj.length > 0) {
                          var str =
                            '<div class="atalk"><span class="dialog">也許下列會有您需要的服務?<br/><ul>';
                          lifeeventobj.forEach(
                            (element) =>
                              (str +=
                                '<li><a class="checkcity" href="#"  data-SN="#" data-Name="' +
                                element +
                                '">' +
                                element +
                                "</a></li>")
                          );
                          str +=
                            '</ul><a target="_blank" href="Advanced_Search.aspx?q=' +
                            searchword +
                            '" title="更多服務" class="talk_sub btnmore" >更多服務</a>' +
                            getDateString() +
                            "</span></div>";
                          append(str);
                          $(".checkcity").click(function () {
                            setCookie("city", $(this).attr("data-Name"), 365);
                            city = $(this).attr("data-Name");
                            savelog($(this).attr("data-Name"));
                            $("#talksub").click();
                          });
                          notfundcount = 0;
                          IsSatisfy = true;
                        } else if (
                          topicobj != null &&
                          topicobj != "" &&
                          topicobj != "\r\n"
                        ) {
                        } else {
                          if (
                            new RegExp(/^[A-Za-z\s\'\.\?\d\$_]*$/gm).test(
                              searchword
                            )
                          ) {
                            append(
                              '<div class="atalk"><span class="dialog">Sorry, I did not get your question.</span></div>'
                            );
                          }
                          console.log(notfundcount < 3);
                          if (notfundcount < 3) {
                            append(
                              '<div class="atalk"><span class="dialog">不好意思！目前沒有完全符合您提問的答案，建議您換個問法，或是一次詢問單一問題，或許我就能回答您喔，謝謝！</span></div>'
                            );
                            notfundcount++;
                          } else {
                            append(
                              '<div class="atalk"><span class="dialog">這個問題沒有合適的答案，也許目前我還無法回答您的問題，歡迎進一步至<a target="_blank" style="color: #2453ff !important;text-decoration: underline !important" href="https://www.service.gov.tw/user_qa_desc.php">線上客服中心</a>提問諮詢。</span></div>'
                            );
                          }
                          getLifeEvent();
                        }
                      }
                      append(topicobj);
                      if (IsSatisfy) {
                        var satisfy =
                          '<div class="atalk"><span class="dialog ">對這次服務滿意嗎?<ul class="evaluate"><li><a onclick=\'satisfylog($(this),"","","","1","' +
                          searchword +
                          '")\'>滿意</a></li><li><a onclick=\'satisfylog($(this),"","","","0","' +
                          searchword +
                          "\")'>不滿意</a></li></ul></span></div>";
                        append(satisfy);
                      }
                    } catch (e) {}
                  },
                });
              },
            });
          }
        },
      });
    };

    $("#countryselect").change(function () {
      var str = "";
      $("#countryselect option:selected").each(function () {
        str += $(this).text() + " ";
      });
      savelog(str);
      //選了選項後的事件待補充
      if (str.trim() != "選擇縣市") {
        append(
          '<div class="btalk"><span class="dialog">' +
            str +
            getDateString() +
            "</span></div>"
        );
        append(
          '<div class="atalk"><span class="dialog">' +
            str +
            "真是個好地方!!" +
            getDateString() +
            "</span></div>"
        );
      }
      city = str;
      setCookie("city", str, 365);
      setTimeout(function () {
        getLifeEvent();
      }, 1000);
    });

    if (city == "") {
      //append('<div class="atalk"><span>請問您所在的地區是?<br/><select id ="countryselect" data-value="" class="form-control country county" name="county"><option value="">選擇縣市</option><option value="臺北市" data-index="0">臺北市</option><option value="基隆市" data-index="1">基隆市</option><option value="新北市" data-index="2">新北市</option><option value="宜蘭縣" data-index="3">宜蘭縣</option><option value="桃園市" data-index="4">桃園市</option><option value="新竹市" data-index="5">新竹市</option><option value="新竹縣" data-index="6">新竹縣</option><option value="苗栗縣" data-index="7">苗栗縣</option><option value="臺中市" data-index="8">臺中市</option><option value="彰化縣" data-index="9">彰化縣</option><option value="南投縣" data-index="10">南投縣</option><option value="嘉義市" data-index="11">嘉義市</option><option value="嘉義縣" data-index="12">嘉義縣</option><option value="雲林縣" data-index="13">雲林縣</option><option value="臺南市" data-index="14">臺南市</option><option value="高雄市" data-index="15">高雄市</option><option value="澎湖縣" data-index="16">澎湖縣</option><option value="金門縣" data-index="17">金門縣</option><option value="屏東縣" data-index="18">屏東縣</option><option value="臺東縣" data-index="19">臺東縣</option><option value="花蓮縣" data-index="20">花蓮縣</option><option value="連江縣" data-index="21">連江縣</option></select></span></div>');
      setCookie("city", "選擇縣市", 365);
    } else {
      $("#countryselect").val(city);
    }
    if (this.fontsize != null && this.fontsize != "") {
      $(".font>." + this.fontsize).trigger("click");
    }
    //if (this.privacy == null || this.privacy != 'true') {
    //    $('.informationBlock>div').hide();
    //    $('.informationBlock>.privacy').show();
    //}
    if (this.role != null && this.role != "") {
      var rolesplit = this.role.split(",");
      for (var i = 0; i < rolesplit.length; i++) {
        $('.user li input[value="' + rolesplit[i] + '"]').prop("checked", true);
      }
    }

    $.ajax({
      type: "get",
      url: "https://www.gov.tw/chatbotapi.aspx?type=recommend",
      cache: true,
      success: function (obj) {
        append(obj);
        setTimeout(function () {
          getLifeEvent("請從人生階段中選擇政府申辦服務！");
        }, 1000);
        setTimeout(function () {
          if (getParameterByName("s") != "") {
            var qaobj;
            $.ajax({
              type: "get",
              url:
                "https://www.gov.tw/chatbotapi.aspx?type=qa&s=" +
                getParameterByName("s"),
              cache: true,
              success: function (obj) {
                try {
                  qaobj = obj;
                  if (qaobj != "" && qaobj.length > 0) {
                    setTimeout(function () {
                      $(".CustomerService").css(
                        "background",
                        "url(../Images/e-book_icon2.gif) no-repeat center"
                      );
                    }, 58000);
                    var str =
                      '<div class="atalk"><span class="dialog">也許下列會有您需要的常見問答?<br/><ul>';

                    qaobj.forEach(
                      (element) =>
                        (str +=
                          '<li><a class="qaobj" target="_blank" data-SN="' +
                          element.SN +
                          '"  data-Name="' +
                          element.Name +
                          '">' +
                          element.Name +
                          "</a></li>")
                    );
                    str += "</ul></span></div>";
                    append(str);
                    var objDiv = document.getElementById("words");
                    objDiv.scrollTop = objDiv.scrollHeight;
                    $(".qaobj").click(function () {
                      append(
                        '<div class="btalk"><span class="dialog">' +
                          $(this).attr("data-Name") +
                          "" +
                          getDateString() +
                          "</span></div>"
                      );
                      var parentSN = $(this).attr("data-SN");
                      var result = qaobj.find((element) => {
                        return element.SN == parentSN;
                      });
                      append(
                        '<div class="atalk"><span class="dialog">' +
                          result.desc +
                          "" +
                          getDateString() +
                          "</span></div>"
                      );
                      var objDiv = document.getElementById("words");
                      objDiv.scrollTop = objDiv.scrollHeight;
                    });
                  }
                } catch (e) {}
              },
            });
          }
        }, 2000);
      },
    });

    $.ajax({
      type: "get",
      url: "https://www.gov.tw/chatbotapi.aspx?type=hotkeyword",
      cache: true,
      success: function (obj) {
        $(".hot_list>ul").append(obj);
        $(".hot_list>ul>li").click(function () {
          $("#talkwords").val($(this).text());
          $("#talksub").trigger("click");
          $(".hot_list").slideToggle("fast");
        });
      },
    });
  };

  //寫入cookies  cookieName:cookieName名稱,cookieValue的值,exdays:保存天數
  function setCookie(cookieName, cookieValue, exdays) {
    if (document.cookie.indexOf(cookieName) >= 0) {
      var expD = new Date();
      expD.setTime(expD.getTime() + -1 * 24 * 60 * 60 * 1000);
      var uexpires = "expires=" + expD.toUTCString();
      document.cookie = cookieName + "=" + cookieValue + "; " + uexpires;
    }
    var d = new Date();
    d.setTime(d.getTime() + exdays * 24 * 60 * 60 * 1000);
    var expires = "expires=" + d.toUTCString();
    document.cookie = cookieName + "=" + cookieValue + "; " + expires;
  }
  //取得cookie
  function getCookie(cookieName) {
    var name = cookieName + "=";
    var ca = document.cookie.split(";");
    for (var i = 0; i < ca.length; i++) {
      var c = ca[i];
      while (c.charAt(0) == " ") c = c.substring(1);
      if (c.indexOf(name) == 0)
        return decodeURIComponent(c.substring(name.length, c.length));
    }
    return "";
  }
  var city = getCookie("city");
  var fontsize = getCookie("fontsize");
  var role = getCookie("role");
  var privacy = getCookie("privacy");
  //詢問人生大事
  function getLifeEvent(des = "請問您目前尋找的服務是哪個人生階段呢?") {
    var lifeeventobj;

    $.ajax({
      type: "get",
      url: "https://www.gov.tw/chatbotapi.aspx?type=lifeeventlevel",
      cache: true,
      success: function (obj) {
        try {
          lifeeventobj = obj;
          var str =
            '<div class="atalk"><span class="dialog">' +
            des +
            "<br/></span></div>";
          var licontent = "";

          lifeeventobj.forEach(
            (element) =>
              (licontent +=
                '<li><div class="life-block"><img src="' +
                element.picurl +
                '" /><div class="title" data-SN="' +
                element.SN +
                '"  data-Name="' +
                element.Name +
                '">' +
                element.Name +
                "</div><ol>" +
                lifteventchildernelement(element.ChildrenObj) +
                "</ol></div></li>")
          );

          licontent =
            '<div  data-index="1" data-sitesmodulesn="1" data-margin_right="0" data-sort="2" data-bgcolor="#0000ffff" data-addparentgroup="False" data-groupsn="10478" data-widthdesktop="0" data-anchor="" data-tabtype="0" class="group-list marquee chat-marquee" data-margin_defaultsetting="false" data-type="4" data-bgclass="" data-widthmobile="0" data-groupname="" data-widthpad="0" data-margin_left="0" data-menuwidth="" data-isgroup="true" data-setlen="2" data-margin_bottom="0" data-child="8" data-margin_top="0" data-func="{\'marqueeHorizontal\':{\'auto\':false,\'delay\':5000,\'speed\':500}}"><div class="in"><div class="ct"><div class="in"><ul data-index="1" data-child="8" style="margin-left: 0%;">' +
            licontent +
            "</ul</div></div></div></div>";
          //str += '</ul>' + getDateString() + '</span></div>';

          append(str);
          append(licontent);
          requirejs(["main"], function (func) {
            func();
          });
          $(".lifeevent").click(function () {
            append(
              '<div class="btalk"><span class="dialog">' +
                $(this).attr("data-Name") +
                "" +
                getDateString() +
                "</span></div>"
            );
            //第二層
            var lifeeventobj;
            var lep = $(this).attr("data-SN");
            $.ajax({
              type: "get",
              url:
                "https://www.gov.tw/chatbotapi.aspx?type=lifeeventsec&parent=" +
                $(this).attr("data-SN"),
              cache: true,
              success: function (obj) {
                lifeeventobj = obj;
                savelog($(this).attr("data-Name"));
                var str =
                  '<div class="atalk"><span class="dialog">請問您目前尋找的服務是屬於哪一個主題呢?<br/><ul>';

                lifeeventobj.forEach(
                  (element) =>
                    (str +=
                      '<li><a class="lifeeventsec" href="#" lep="' +
                      lep +
                      '" data-SN="' +
                      element.SN +
                      '"  data-Name="' +
                      element.Name +
                      '">' +
                      element.Name +
                      "</a></li>")
                );
                str += "</ul>" + getDateString() + "</span></div>";
                append(str);

                $(".lifeeventsec").click(function () {
                  append(
                    '<div class="btalk"><span class="dialog">' +
                      $(this).attr("data-Name") +
                      "" +
                      getDateString() +
                      "</span></div>"
                  );
                  //第三層
                  var lifeeventobj;
                  var lep = $(this).attr("lep");
                  var parentSN = $(this).attr("data-SN");
                  console.log(parentSN);
                  $.ajax({
                    type: "get",
                    url:
                      "https://www.gov.tw/chatbotapi.aspx?type=servicetitle&parent=" +
                      $(this).attr("data-SN") +
                      "&city=" +
                      city,
                    cache: true,
                    success: function (obj) {
                      lifeeventobj = obj;
                      savelog($(this).attr("data-Name"));
                      if (
                        lifeeventobj != undefined &&
                        lifeeventobj.length > 0
                      ) {
                        var str =
                          '<div class="atalk"><span class="dialog">也許下列會有您需要的服務?<br/><ul>';

                        lifeeventobj.forEach(
                          (element) =>
                            (str +=
                              '<li><a class="lifeeventsec" target="_blank" href="' +
                              element.url +
                              '" data-SN="' +
                              element.SN +
                              '"  data-Name="' +
                              element.Name +
                              '">' +
                              element.Name +
                              "<span>" +
                              element.dep +
                              "</span></a></li>")
                        );
                        str +=
                          '</ul><a target="_blank" href="News_LifeEvent.aspx?lep=' +
                          lep +
                          "&le=" +
                          parentSN +
                          '" title="更多服務" class="talk_sub btnmore" >更多服務</a><br/>或查詢其他服務關鍵字。' +
                          getDateString() +
                          "</span></div>";
                        append(str);
                        var satisfy =
                          '<div class="atalk"><span class="dialog ">對這次服務滿意嗎?<ul class="evaluate"><li><a onclick=\'satisfylog($(this),"",' +
                          lep +
                          "," +
                          parentSN +
                          ',"1","")\'>滿意</a></li><li><a onclick=\'satisfylog($(this),"",' +
                          lep +
                          "," +
                          parentSN +
                          ',"0","")\'>不滿意</a></li></ul></span></div>';
                        append(satisfy);

                        $(".lifeeventsec").click(function () {
                          console.log($(this).attr("href"));
                          savelog("linkto:" + $(this).attr("href"));
                        });
                      } else {
                        var time = new Date().getTime();
                        append(
                          '<div class="atalk"><span class="dialog">不好意思！目前無相關服務，歡迎進一步至<a target="_blank" style="color: #2453ff !important;text-decoration: underline !important" href="https://www.service.gov.tw/user_qa_desc.php">線上客服中心</a>提問諮詢。' +
                            getDateString() +
                            "</span></div>"
                        );
                      }
                    },
                  });
                });
              },
            });
          });
        } catch (e) {}
      },
    });
  }
  function lifteventchildernelement(childrenobj) {
    var childrencontent = "";
    childrenobj.forEach(
      (element) =>
        (childrencontent +=
          '<li><a class="lifeevent" href="#" data-SN="' +
          element.SN +
          '"  data-Name="' +
          element.Name +
          '">' +
          element.Name +
          "</a></li>")
    );
    return childrencontent;
  }
  function savelog(text) {
    $.ajax({
      type: "get",
      url: "https://www.gov.tw/chatbotlogapi.aspx?type=log&s=" + text,
      cache: true,
      async: false,
      success: function (obj) {
        //console.log('savelog:' + text)
      },
    });
  }
  function satisfylog(a, s, lep, l, type, text) {
    console.log($(a));
    if ($(a).parent().parent().find(".is-active").length == 0) {
      $(a).addClass("is-active");
      $.ajax({
        type: "get",
        url:
          "https://www.gov.tw/chatbotlogapi.aspx?type=satisfy&s=" +
          s +
          "&lep=" +
          lep +
          "&l=" +
          l +
          "&t=" +
          type +
          "&text=" +
          text,
        cache: true,
        async: false,
        success: function (obj) {
          console.log("s:" + s);
          console.log("lep:" + lep);
          console.log("l:" + l);
          console.log("type:" + type);
        },
      });
    }
  }
  function getDateString() {
    var date = new Date();
    var hour = date.getHours();
    if (date.getHours() < 10) {
      hour = "0" + date.getHours();
    }
    var minute = date.getMinutes();
    if (date.getMinutes() < 10) {
      minute = "0" + date.getMinutes();
    }
    var sec = date.getSeconds();
    if (date.getSeconds() < 10) {
      sec = "0" + date.getSeconds();
    }
    return '<span class="time">' + hour + ":" + minute + ":" + sec + "</span>";
  }
  function append(text) {
    $(text).appendTo($("#words"));
    //$('#words').append(text);
    var objDiv = document.getElementById("words");
    objDiv.scrollTop = objDiv.scrollHeight;
  }

  function autocomplete(inp, arr) {
    inp.addEventListener("input", function (e) {
      var a,
        b,
        i,
        val = this.value;
      closeAllLists();
      if (!val) {
        return false;
      }
      currentFocus = -1;
      a = document.createElement("DIV");
      a.setAttribute("id", this.id + "autocomplete-list");
      a.setAttribute("class", "autocomplete-items");
      this.parentNode.insertBefore(a, this.parentNode.firstChild);
      for (i = 0; i < arr.length; i++) {
        if (arr[i].substr(0, val.length).toUpperCase() == val.toUpperCase()) {
          b = document.createElement("DIV");
          b.innerHTML = "<strong>" + arr[i].substr(0, val.length) + "</strong>";
          b.innerHTML += arr[i].substr(val.length);
          b.innerHTML += "<input type='hidden' value='" + arr[i] + "'>";
          b.addEventListener("click", function (e) {
            inp.value = this.getElementsByTagName("input")[0].value;
            closeAllLists();
          });
          a.appendChild(b);
        }
      }
    });
    inp.addEventListener("keydown", function (e) {
      var x = document.getElementById(this.id + "autocomplete-list");
      if (x) x = x.getElementsByTagName("div");
      if (e.keyCode == 40) {
        currentFocus++;
        addActive(x);
      } else if (e.keyCode == 38) {
        currentFocus--;
        addActive(x);
      } else if (e.keyCode == 13) {
        e.preventDefault();
        if (currentFocus > -1) {
          if (x) x[currentFocus].click();
        }
      }
    });
    function addActive(x) {
      if (!x) return false;
      removeActive(x);
      if (currentFocus >= x.length) currentFocus = 0;
      if (currentFocus < 0) currentFocus = x.length - 1;
      x[currentFocus].classList.add("autocomplete-active");
    }
    function removeActive(x) {
      for (var i = 0; i < x.length; i++) {
        x[i].classList.remove("autocomplete-active");
      }
    }
    function closeAllLists(elmnt) {
      var x = document.getElementsByClassName("autocomplete-items");
      for (var i = 0; i < x.length; i++) {
        if (elmnt != x[i] && elmnt != inp) {
          x[i].parentNode.removeChild(x[i]);
        }
      }
    }
    document.addEventListener("click", function (e) {
      closeAllLists(e.target);
    });
  }
</script>
<div class="talk_con" style="display: none">
  <div class="talk_header">
    <span class="chat_title">我的E政府 智能幫手</span><a class="close">X</a>
    <div class="information">
      <div class="box">
        <ul>
          <li class="btn_statify">
            <span
              ><a href="javascript: void(0)" title="滿意度調查"
                >滿意度調查</a
              ></span
            >
          </li>
          <li class="btn_privacy">
            <span
              ><a href="cp.aspx?n=16" target="_blank" title="隱私權保護政策"
                >隱私權保護政策</a
              ></span
            >
          </li>
          <li class="btn_description">
            <span
              ><a href="javascript: void(0)" title="服務說明">服務說明</a></span
            >
          </li>
        </ul>
      </div>
    </div>

    <div class="set_up">
      <div class="box">
        <div class="sort">
          <div class="title">字型</div>

          <ul class="font">
            <li class="small" data-index="1">
              <span><a href="javascript: void(0)" title="小字級">小</a></span>
            </li>
            <li class="medium is-active">
              <span><a href="javascript: void(0)" title="中字級">中</a></span>
            </li>
            <li class="large">
              <span><a href="javascript: void(0)" title="大字級">大</a></span>
            </li>
          </ul>
        </div>

        <div class="sort">
          <div class="title">角色</div>

          <ul class="user">
            <li><input name="checkRole" type="checkbox" value="01" />孕婦</li>
            <li><input name="checkRole" type="checkbox" value="02" />學生</li>
            <li>
              <input name="checkRole" type="checkbox" value="03" />新手爸媽
            </li>
            <li><input name="checkRole" type="checkbox" value="04" />役男</li>
            <li><input name="checkRole" type="checkbox" value="05" />銀髮族</li>
            <li>
              <input name="checkRole" type="checkbox" value="06" />身心障礙
            </li>
            <li><input name="checkRole" type="checkbox" value="07" />原住民</li>
            <li><input name="checkRole" type="checkbox" value="08" />外國人</li>
            <li>
              <input name="checkRole" type="checkbox" value="09" />弱勢家庭
            </li>
            <li><input name="checkRole" type="checkbox" value="10" />上班族</li>
            <li><input name="checkRole" type="checkbox" value="11" />創業家</li>
            <li>
              <input name="checkRole" type="checkbox" value="12" />退休勞工
            </li>
          </ul>
        </div>
        <!--<div class="sort">
                                        <div class="title">縣市</div>
                                        <select id="countryselect" data-value="" class="form-control text-select country county" name="county">
                                            <option value="-1">選擇縣市</option>
                                            <option value="臺北市" data-index="0">臺北市</option>
                                            <option value="基隆市" data-index="1">基隆市</option>
                                            <option value="新北市" data-index="2">新北市</option>
                                            <option value="宜蘭縣" data-index="3">宜蘭縣</option>
                                            <option value="桃園市" data-index="4">桃園市</option>
                                            <option value="新竹市" data-index="5">新竹市</option>
                                            <option value="新竹縣" data-index="6">新竹縣</option>
                                            <option value="苗栗縣" data-index="7">苗栗縣</option>
                                            <option value="臺中市" data-index="8">臺中市</option>
                                            <option value="彰化縣" data-index="9">彰化縣</option>
                                            <option value="南投縣" data-index="10">南投縣</option>
                                            <option value="嘉義市" data-index="11">嘉義市</option>
                                            <option value="嘉義縣" data-index="12">嘉義縣</option>
                                            <option value="雲林縣" data-index="13">雲林縣</option>
                                            <option value="臺南市" data-index="14">臺南市</option>
                                            <option value="高雄市" data-index="15">高雄市</option>
                                            <option value="澎湖縣" data-index="16">澎湖縣</option>
                                            <option value="金門縣" data-index="17">金門縣</option>
                                            <option value="屏東縣" data-index="18">屏東縣</option>
                                            <option value="臺東縣" data-index="19">臺東縣</option>
                                            <option value="花蓮縣" data-index="20">花蓮縣</option>
                                            <option value="連江縣" data-index="21">連江縣</option>
                                        </select>
                                    </div>-->

        <div class="btn">
          <a
            class="talk_sub"
            href="javascript: void(0)"
            id="btn_RoleSet"
            title="確定"
            >確定</a
          >
          <a
            class="talk_sub"
            href="javascript: void(0)"
            id="btn_RoleReset"
            title="重設"
            >重設</a
          >
          <script>
            //role

            $("#btn_RoleSet").click(function () {
              var Rolevalues = new Array();
              $.each($(".user li input:checked"), function () {
                Rolevalues.push($(this).val());
              });
              setCookie("role", Rolevalues, 365);
              $.ajax({
                type: "get",
                url:
                  "/chatbotapi.aspx?type=idlerecommend&role=" +
                  Rolevalues.toString(),
                cache: true,
                success: function (obj) {
                  append(obj);
                },
              });
              $(".set_up>.btn").trigger("click");
            });
            $("#btn_RoleReset").click(function () {
              $(".user li input:checked").prop("checked", false);
              var Rolevalues = new Array();
              setCookie("role", Rolevalues, 365);
            });
          </script>
        </div>
      </div>
    </div>
  </div>

  <div class="informationBlock">
    <div class="statify" style="display: none">
      <div class="title">滿意度調查</div>

      <div>
        <div class="chat-footer">
          <div
            class="area-form vote"
            data-child="1"
            data-type="0"
            data-votesatisfiedkey="B554CCD93F7D56F9"
          >
            <div class="in">
              <div class="hd">
                <div class="in">
                  <div data-index="0">&nbsp;</div>
                </div>
              </div>

              <div class="ct">
                <div class="in">
                  <script>
                    function SetCheck(val) {
                      $("a[ID^='Satisfied']").each(function () {
                        $(this).attr("IsChecked", "false");
                      });
                      $("#Satisfied_" + val).attr("IsChecked", "true");
                    }
                  </script>
                  <div class="essay" data-step="1" style="">
                    <div class="caption">&nbsp;</div>
                  </div>

                  <div class="area-form vote" data-step="1" style="">
                    <span
                      >請問您對於智能客服「E-GOV小幫手」這次提供的服務整體滿意度為何?（五顆星＝非常滿意）
                    </span>

                    <div class="fieldset">
                      <input
                        data-satisfiedvalue="1"
                        id="Satisfied_0"
                        name="Satisfied"
                        title="1顆星"
                        type="radio"
                      />
                      <label for="Satisfied_0">1顆星</label>
                      <input
                        data-satisfiedvalue="2"
                        id="Satisfied_1"
                        name="Satisfied"
                        title="2顆星"
                        type="radio"
                      />
                      <label for="Satisfied_1">2顆星</label>
                      <input
                        data-satisfiedvalue="3"
                        id="Satisfied_2"
                        name="Satisfied"
                        title="3顆星"
                        type="radio"
                      />
                      <label for="Satisfied_2">3顆星</label>
                      <input
                        data-satisfiedvalue="4"
                        id="Satisfied_3"
                        name="Satisfied"
                        title="4顆星"
                        type="radio"
                      />
                      <label for="Satisfied_3">4顆星</label>
                      <input
                        checked="checked"
                        data-satisfiedvalue="5"
                        id="Satisfied_4"
                        name="Satisfied"
                        title="5顆星"
                        type="radio"
                      />
                      <label for="Satisfied_4">5顆星</label>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <textarea
          cols="50"
          id="txt_satisfied"
          placeholder="請您留下寶貴意見，我們將會持續努力提供更完美的服務，謝謝！（限50字，選填）"
          rows="4"
        ></textarea>
      </div>

      <div class="btn">
        <a
          class="talk_sub"
          href="javascript: void(0)"
          id="btn_submit"
          title="送出"
          >送出</a
        >
        <a
          class="talk_sub"
          href="javascript: void(0)"
          id="btn_cancel"
          title="取消"
          >取消</a
        >
      </div>
      <script>
        $("#btn_submit").click(function () {
          event.preventDefault();
          var satisfied = getCookie("satisfied");
          if ($("#txt_satisfied").val().length > 50) {
            alert("意見最多填寫50字");
          } else if (satisfied != null && satisfied != "true") {
            var satisfied_value = $('input[name="Satisfied"]:checked').data(
              "satisfiedvalue"
            );
            $.ajax({
              url: "Common/ChatbotSatisfie.ashx",
              type: "POST",
              data: {
                s: 0,
                satisfie: satisfied_value,
                unsatisfie: $("#txt_satisfied").val(),
              },
            });
            alert("感謝您寶貴的意見");
            //setCookie('satisfied', 'true', 365);
            $(".informationBlock>div").hide();
            $("#txt_satisfied").val("");
          } else {
            alert("您已填寫過滿意度");
            $(".informationBlock>div").hide();
            $("#txt_satisfied").val("");
          }
        });
        $("#btn_cancel").click(function () {
          $(".informationBlock>div").hide();
        });
      </script>
    </div>

    <div class="privacy" style="display: none">
      <div class="title">個資保密聲明</div>

      <div class="content">
        本網站使用前瞻技術提供更好的使用體驗，同時尊重使用者隱私，為維護您的權益，開始使用前懇請事先詳閱「<a
          href="https://www.gov.tw/cp.aspx?n=16"
          title="隱私權保護政策"
          >隱私權保護政策</a
        >」。當您點擊「我同意」時，視同您已充分了解並同意本網站智能客服「E-GOV小幫手」開始蒐集與處理您所提供的資料，蒐集範圍將包含使用COOKIE記住您的角色與當次對話紀錄。
      </div>

      <div class="btn">
        <a
          class="talk_sub"
          href="javascript: void(0)"
          id="btn_agree"
          title="我同意"
          >我同意</a
        >
        <a
          class="talk_sub"
          href="javascript: void(0)"
          id="btn_disagree"
          title="我不同意"
          >我不同意</a
        >
        <script>
          $("#btn_agree").click(function () {
            setCookie("privacy", "true", 365);
            $(".informationBlock>div").hide();
          });
          $("#btn_disagree").click(function () {
            $(".informationBlock>div").hide();
          });
        </script>
      </div>
    </div>

    <div class="description" style="display: none">
      <div class="title">服務說明</div>

      <div class="content">
        <div class="subtitle">智能文字交談服務時間</div>

        <div class="text">24小時全年無休</div>

        <div class="subtitle">服務範圍</div>

        <div class="text">
          E-GOV小幫手提供人生大事階段、申辦服務引導查找，依個人化設定進行關聯推薦，請多加利用。
        </div>
      </div>

      <div class="btn">
        <a
          class="talk_sub"
          href="javascript: void(0)"
          id="btn_close"
          title="我知道了"
          >我知道了</a
        >
      </div>
      <script>
        $("#btn_close").click(function () {
          setCookie("privacy", "true", 365);
          $(".informationBlock>div").hide();
        });
      </script>
    </div>
  </div>

  <div class="talk_show" id="words">&nbsp;</div>

  <div
    class="talk_show"
    id="tempwords"
    style="top: -100px; height: 100px !important"
  >
    &nbsp;
  </div>

  <div class="hot_list">
    <div class="title">
      下列為其他使用者常搜尋的關鍵字
      <a
        class="talk_sub talkhotclose"
        href="javascript: void(0)"
        id="talkhotclose"
        title="關閉"
        >X</a
      >
    </div>

    <ul></ul>
  </div>

  <div class="auto_complete">&nbsp;</div>

  <div class="talk_input">
    <a class="talk_sub hot" href="javascript: void(0)" id="talkhot" title="熱門"
      >熱門</a
    >
    <input class="talk_word" id="talkwords" type="text" />
    <a class="talk_sub" href="javascript: void(0)" id="talksub" title="傳送"
      >傳送</a
    >
  </div>
</div>

<div
  class="area-editor default e-book-icon"
  data-addparentgroup="False"
  data-anchor=""
  data-bgclass="e-book-icon"
  data-bgcolor="#0000ffff"
  data-child="1"
  data-groupname=""
  data-groupsn="2274"
  data-index="5"
  data-isgroup="true"
  data-margin_bottom="0"
  data-margin_defaultsetting="false"
  data-margin_left="0"
  data-margin_right="0"
  data-margin_top="0"
  data-menuwidth=""
  data-setlen="0"
  data-sitesmodulesn="6"
  data-sort="10"
  data-tabtype="0"
  data-type="0"
  data-widthdesktop="0"
  data-widthmobile="0"
  data-widthpad="0"
  id="Group_2274_LkeNWcGYvv"
  style="display: none"
>
  <div class="in">
    <div class="ct">
      <div class="in">
        <p>
          <a
            class="e-book-close"
            href="javascript: void(0)"
            title="關閉E-GOV小幫手"
            >X</a
          ><a
            class="CustomerService"
            href="javascript: void(0)"
            title="智能幫手"
            >智能幫手</a
          >
        </p>
      </div>
    </div>
  </div>
</div>
